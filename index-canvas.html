<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Mr. Scott’s Block Fun — Canvas Edition</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link href="https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet"/>

  <style>
    :root{
      --bg-url:none;
      --ink:#0af7a3;
      --cyan:#07e1ff;
      --amber:#ffb000;
      --violet:#7a5cff;
      --space:#070a16;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:'JetBrains Mono','Courier Prime',monospace;
      background:var(--space);color:#00ffb2;
      min-height:100vh;padding:1rem;overflow-x:hidden;position:relative;
    }
    .mc-bg{position:fixed;inset:0;z-index:-2;pointer-events:none;overflow:hidden;}
    .mc-art{position:absolute;inset:-2%;
      background:var(--bg-url),radial-gradient(120% 120% at 50% 10%,rgba(5,12,22,.9),rgba(3,8,16,1));
      background-size:cover;background-position:center;
      filter:saturate(1.05)contrast(1.02)brightness(.95);
      animation:mcDrift 22s ease-in-out infinite alternate;}
    @keyframes mcDrift{from{transform:scale(1.02)}to{transform:scale(1.06)translate(-2%,2%)}}
    .mc-aurora{position:absolute;inset:-10%;
      background:radial-gradient(40% 60% at 20% 10%,rgba(122,92,255,.28)0%,transparent60%),
                 radial-gradient(48% 58% at 80% 0%,rgba(7,225,255,.22)0%,transparent60%),
                 radial-gradient(46% 62% at 80% 80%,rgba(18,255,176,.20)0%,transparent70%);
      filter:blur(28px)saturate(120%);
      animation:mcAurora 14s ease-in-out infinite alternate;}
    @keyframes mcAurora{0%{transform:none}100%{transform:translate(-2%,2%)scale(1.04)}}
    .mc-scan{position:absolute;inset:0;background:linear-gradient(transparent50%,rgba(0,0,0,.18)50%);
      background-size:100%3px;opacity:.25;}
    .mc-vignette{position:absolute;inset:0;
      background:radial-gradient(120%120%at50%25%,transparent55%,rgba(0,0,0,.45)90%),
                 radial-gradient(100%100%at50%120%,rgba(0,0,0,.55),transparent50%);
      mix-blend-mode:multiply;}
    .mc-watermark{position:absolute;right:12px;bottom:10px;user-select:none;
      font-weight:800;letter-spacing:.25rem;font-size:.75rem;
      color:rgba(18,255,176,.22);text-shadow:0 0 8px rgba(18,255,176,.25);}
    .container{max-width:1200px;margin:0 auto;position:relative;}
    .title{text-align:center;font-size:3rem;font-weight:800;letter-spacing:.6rem;margin-bottom:2rem;
      color:#b6fff1;text-shadow:0 0 10px var(--ink),0 0 24px var(--ink),0 0 48px var(--cyan);
      animation:glow 2s ease-in-out infinite alternate;}
    @keyframes glow{from{text-shadow:0 0 18px var(--ink),0 0 28px var(--cyan)}
                    to{text-shadow:0 0 26px var(--ink),0 0 40px var(--cyan)}}
    .game-layout{display:grid;grid-template-columns:1fr auto 1fr;gap:2rem;align-items:start;}
    .game-board{border:4px solid rgba(18,255,176,.8);border-radius:8px;
      background:radial-gradient(120%120%at50%10%,rgba(5,12,22,.9),rgba(3,8,16,1));
      box-shadow:0 0 24px rgba(18,255,176,.35),inset0 0 24px rgba(18,255,176,.08),0 0 80px rgba(7,225,255,.08);
      display:flex;justify-content:center;align-items:center;padding:4px;}
    #gameCanvas{display:block;image-rendering:pixelated;max-width:100%;height:auto;}
    .side-panel{background:linear-gradient(180deg,rgba(12,18,32,.72),rgba(8,12,24,.72));
      border:2px solid rgba(18,255,176,.65);border-radius:8px;padding:1.5rem;
      box-shadow:0 0 24px rgba(18,255,176,.25),inset0 0 28px rgba(0,0,0,.35);}
    .panel-title{font-size:1.1rem;font-weight:800;text-align:center;margin-bottom:1rem;
      color:#b6fff1;text-shadow:0 0 8px rgba(18,255,176,.45);}
    .score-item{display:flex;justify-content:space-between;margin-bottom:.5rem;font-size:.9rem;}
    .score-value{color:var(--cyan);font-weight:800;}
    .mini-grid{width:96px;height:96px;border:2px solid #004400;border-radius:4px;background:#000;
      margin:.5rem auto;display:grid;grid-template-columns:repeat(4,1fr);grid-template-rows:repeat(4,1fr);
      gap:1px;padding:4px;}
    .preview-cell{background:#000;border-radius:1px;}
    .mini-list{display:grid;grid-template-columns:repeat(1,1fr);gap:.5rem;justify-items:center;}
    .controls{display:flex;flex-direction:column;gap:1rem;}
    .btn{background:rgba(10,16,28,.85);border:2px solid rgba(18,255,176,.6);
      color:var(--ink);padding:.75rem 1rem;border-radius:4px;font-weight:700;cursor:pointer;
      transition:.15s;text-transform:uppercase;}
    .btn:hover:not(:disabled){background:rgba(12,20,36,1);border-color:var(--cyan);
      box-shadow:0 0 14px rgba(7,225,255,.45);}
    .btn:disabled{opacity:.5;cursor:not-allowed;}
    .btn-primary{background:linear-gradient(180deg,#0a3,#092);color:#fff;}
    .hidden{display:none!important;}
    .opt{display:grid;grid-template-columns:auto 1fr;gap:.5rem .75rem;align-items:center;font-size:.8rem;margin-top:.75rem;}
    .opt input[type="number"],.opt select{background:#0a0a0a;color:#9fffbf;border:1px solid #044;
      border-radius:4px;padding:.3rem .4rem;width:100%;}
    .opt input[type="range"]{width:100%;}
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.9);
      display:flex;align-items:center;justify-content:center;z-index:1000;padding:1rem;}
    .modal-content{background:#111;border:4px solid rgba(18,255,176,.8);border-radius:8px;padding:2rem;
      text-align:center;max-width:720px;width:100%;box-shadow:0 0 30px rgba(0,255,176,.5);}
    .modal-title{font-size:2.2rem;font-weight:900;margin-bottom:1rem;color:#b6fff1;text-shadow:0 0 15px var(--ink);}
    .modal-text{margin-bottom:1.1rem;color:#00cccc;}
    .modal-stats{margin:1rem 0;display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;}
    .stat-item{background:#000;border:1px solid #044;border-radius:4px;padding:.5rem;}
    .stat-value{font-size:1.2rem;font-weight:900;color:var(--cyan);}
    .stat-label{font-size:.8rem;color:#0a0;}
    .color-I{background:#00f0ff!important;}
    .color-O{background:#ffd900!important;}
    .color-T{background:#9d63ff!important;}
    .color-S{background:#15ff76!important;}
    .color-Z{background:#ff4b4b!important;}
    .color-J{background:#4a74ff!important;}
    .color-L{background:#ff9a2b!important;}
    @media(max-width:1024px){.game-layout{grid-template-columns:1fr;gap:1.5rem;}.title{font-size:2.5rem;letter-spacing:.3rem;}}
    @media(max-width:640px){.title{font-size:2rem;letter-spacing:.2rem;}.modal-title{font-size:2rem;}.mc-watermark{font-size:.6rem;letter-spacing:.18rem;}}
  </style>
</head>
<body>
  <div class="mc-bg"><div class="mc-art"></div><div class="mc-aurora"></div><div class="mc-scan"></div><div class="mc-vignette"></div><div class="mc-watermark">MCSTEPHEN</div></div>

  <div class="container">
    <h1 class="title">M R  S C O T T’ S  B L O C K  F U N</h1>

    <!-- Panels & Canvas omitted for brevity (same structure as your version) -->
    <!-- Paste your side panels, modals, etc., here — no structural changes needed -->

  </div>

  <script>
  /* ----------- GAME LOGIC (condensed to changed parts) ----------- */
  function ac(){ if(!window.AC){ try{window.AC=new (window.AudioContext||window.webkitAudioContext)();}catch{return null;} } return window.AC; }
  function beep(freq=440,dur=0.06,gain=0.03){ const c=ac(); if(!c)return;
    const o=c.createOscillator(),g=c.createGain(); o.type='square';o.frequency.value=freq;g.gain.value=gain;
    o.connect(g);g.connect(c.destination);o.start();o.stop(c.currentTime+dur);}
  /* your entire game script goes here, unchanged except the few edits below */

  // --- Fixed ArrowDown newline bug ---
  document.addEventListener('keydown',e=>{
    const k=e.key;
    if(k===KEYS.down){ e.preventDefault(); state.downHeld=true; markInput(); }
  });

  // --- Added button start listener ---
  startBtn.addEventListener('click',()=>startGame());

  // --- Improved ghost pulse in drawBoard() ---
  // inside drawBoard replace ghost draw section with:
  /*
  if(state.ghost && state.cur){
    const gy=ghostY(state.board,state.cur);
    const pulse=(lockSince!==null)?(Math.sin((performance.now()-lockSince)/100)*0.2+0.65):0.35;
    for(const {x,y} of currentCells({...state.cur,y:gy})){
      if(y>=0) drawCell(x,y,state.cur.class,pulse);
    }
  }
  */

  // --- Optional local asset switch ---
  const ASSET_BASE='';
  // replace MUSIC_TRACKS/BACKGROUND_IMAGES arrays with local paths later
  </script>
</body>
</html>
